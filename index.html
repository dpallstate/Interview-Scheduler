<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interview Scheduler</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .slot-button {
            transition: all 0.2s ease;
        }
        .slot-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAD97WCKVxz8XGntwMsylvedKfPYUk_ga8",
            authDomain: "interview-scheduling-app-477ff.firebaseapp.com",
            projectId: "interview-scheduling-app-477ff",
            storageBucket: "interview-scheduling-app-477ff.firebasestorage.app",
            messagingSenderId: "667733211153",
            appId: "1:667733211153:web:a172b3dcc69f6fe85859b0",
            measurementId: "G-BBBEXSMS2H"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        const { useState, useEffect } = React;

        // Utility functions
        const generateId = () => Math.random().toString(36).substr(2, 9);

        const timeToMinutes = (time) => {
            const [hours, minutes] = time.split(":").map(Number);
            return hours * 60 + minutes;
        };

        const minutesToTime = (mins) => {
            const hours = Math.floor(mins / 60);
            const minutes = mins % 60;
            return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
        };

        const generateTimeSlots = () => {
            const slots = [];
            for (let hour = 9; hour < 17; hour++) {
                for (let minute = 0; minute < 60; minute += 30) {
                    slots.push(hour * 60 + minute);
                }
            }
            return slots;
        };

        const getNextWorkdays = (count = 7) => {
            const days = [];
            const today = new Date();
            let current = new Date(today);
            
            while (days.length < count) {
                const dayOfWeek = current.getDay();
                if (dayOfWeek !== 0 && dayOfWeek !== 6) { // Skip weekends
                    days.push(new Date(current));
                }
                current.setDate(current.getDate() + 1);
            }
            return days;
        };

        const formatDate = (date) => {
            return date.toLocaleDateString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        };

        // Convert various time formats to canonical HH:mm
        const canonicalizeTime = (time) => {
            const canonicalMatch = /^([01]\d|2[0-3]):([0-5]\d)$/;
            if (canonicalMatch.test(time)) return time;

            const legacyMatch = /^(\d{1,2}):(\d{2})\s*(AM|PM)$/i;
            let match = legacyMatch.exec(time);
            if (match) {
                let hour = parseInt(match[1], 10);
                const minute = match[2];
                const period = match[3].toUpperCase();
                if (period === 'PM' && hour !== 12) hour += 12;
                if (period === 'AM' && hour === 12) hour = 0;
                return `${hour.toString().padStart(2, '0')}:${minute}`;
            }

            const shortMatch = /^(\d{1,2}):(\d{2})$/;
            match = shortMatch.exec(time);
            if (match) {
                const hour = parseInt(match[1], 10);
                const minute = match[2];
                return `${hour.toString().padStart(2, '0')}:${minute}`;
            }

            return time;
        };

        // Loading Component
        const LoadingSpinner = () => (
            <div className="flex justify-center items-center p-8">
                <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
            </div>
        );

        // Recruiter Dashboard Component
        const RecruiterDashboard = ({ setCurrentView, setScheduleId, setIsClient }) => {
            const [schedules, setSchedules] = useState([]);
            const [loading, setLoading] = useState(true);
            const [showForm, setShowForm] = useState(false);
            const [formData, setFormData] = useState({
                candidateName: '',
                clientCompany: '',
                jobTitle: ''
            });

            useEffect(() => {
                loadSchedules();
            }, []);

            const loadSchedules = async () => {
                try {
                    const snapshot = await db.collection('schedules').get();
                    const schedulesData = snapshot.docs.map(doc => {
                        const data = doc.data();
                        if (data.bookedSlot && typeof data.bookedSlot.time === 'string') {
                            data.bookedSlot.time = timeToMinutes(data.bookedSlot.time);
                        }
                        if (data.candidateAvailability) {
                            Object.entries(data.candidateAvailability).forEach(([dateKey, times]) => {
                                data.candidateAvailability[dateKey] = times.map(t => typeof t === 'number' ? t : timeToMinutes(t));
                            });
                        }
                        return { id: doc.id, ...data };
                    });
                    setSchedules(schedulesData);
                } catch (error) {
                    console.error('Error loading schedules:', error);
                } finally {
                    setLoading(false);
                }
            };

            const createSchedule = async (e) => {
                e.preventDefault();
                if (!formData.candidateName || !formData.clientCompany || !formData.jobTitle) return;

                try {
                    const scheduleId = generateId();
                    const newSchedule = {
                        id: scheduleId,
                        candidateName: formData.candidateName,
                        clientCompany: formData.clientCompany,
                        jobTitle: formData.jobTitle,
                        createdAt: new Date(),
                        candidateAvailability: {},
                        bookedSlot: null,
                        status: 'pending'
                    };

                    await db.collection('schedules').doc(scheduleId).set(newSchedule);
                    setSchedules([...schedules, newSchedule]);
                    setFormData({ candidateName: '', clientCompany: '', jobTitle: '' });
                    setShowForm(false);
                } catch (error) {
                    console.error('Error creating schedule:', error);
                }
            };

            const deleteSchedule = async (scheduleId) => {
                if (!confirm('Are you sure you want to delete this schedule?')) return;
                
                try {
                    await db.collection('schedules').doc(scheduleId).delete();
                    setSchedules(schedules.filter(s => s.id !== scheduleId));
                } catch (error) {
                    console.error('Error deleting schedule:', error);
                }
            };

            const generateShareableLink = (scheduleId, isClient = false) => {
                // Get the current URL without any query parameters
                const baseUrl = window.location.href.split('?')[0];
                return `${baseUrl}?id=${scheduleId}${isClient ? '&client=true' : ''}`;
            };

            const copyToClipboard = async (text) => {
                try {
                    await navigator.clipboard.writeText(text);
                    alert('Link copied to clipboard!\n\nNote: When running locally, you can also just use the Demo buttons to test the workflow.');
                } catch (err) {
                    // Fallback for browsers that don't support clipboard API
                    const textArea = document.createElement('textarea');
                    textArea.value = text;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    alert('Link copied to clipboard!\n\nNote: When running locally, you can also just use the Demo buttons to test the workflow.');
                }
            };

            if (loading) return <LoadingSpinner />;

            return (
                <div className="max-w-6xl mx-auto p-6">
                    <div className="bg-white rounded-xl shadow-lg p-8 mb-8">
                        <div className="flex justify-between items-center mb-6">
                            <h1 className="text-3xl font-bold text-gray-800">Recruiter Dashboard</h1>
                            <button
                                onClick={() => setShowForm(!showForm)}
                                className="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium transition-colors"
                            >
                                {showForm ? 'Cancel' : 'Create New Schedule'}
                            </button>
                        </div>

                        {window.location.protocol === 'file:' && (
                            <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6">
                                <p className="text-yellow-800 text-sm">
                                    💡 <strong>Running locally:</strong> The copied links won't work when running from your computer. 
                                    Deploy to Netlify/Vercel for shareable links that work!
                                </p>
                            </div>
                        )}

                        {showForm && (
                            <div className="bg-gray-50 rounded-lg p-6 mb-6 fade-in">
                                <h2 className="text-xl font-semibold mb-4">Create Interview Schedule</h2>
                                <form onSubmit={createSchedule} className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <input
                                        type="text"
                                        placeholder="Candidate Name"
                                        value={formData.candidateName}
                                        onChange={(e) => setFormData({...formData, candidateName: e.target.value})}
                                        className="px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                        required
                                    />
                                    <input
                                        type="text"
                                        placeholder="Job Title"
                                        value={formData.jobTitle}
                                        onChange={(e) => setFormData({...formData, jobTitle: e.target.value})}
                                        className="px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                        required
                                    />
                                    <input
                                        type="text"
                                        placeholder="Client Company"
                                        value={formData.clientCompany}
                                        onChange={(e) => setFormData({...formData, clientCompany: e.target.value})}
                                        className="px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                        required
                                    />
                                    <button
                                        type="submit"
                                        className="md:col-span-3 bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg font-medium transition-colors"
                                    >
                                        Create Schedule
                                    </button>
                                </form>
                            </div>
                        )}

                        <div className="grid gap-6">
                            {schedules.length === 0 ? (
                                <div className="text-center py-12">
                                    <div className="text-gray-400 text-6xl mb-4">📅</div>
                                    <p className="text-gray-500 text-lg">No schedules created yet</p>
                                </div>
                            ) : (
                                schedules.map(schedule => (
                                    <div key={schedule.id} className="bg-gray-50 rounded-lg p-6 border border-gray-200">
                                        <div className="flex flex-col lg:flex-row lg:items-center justify-between gap-4">
                                            <div className="flex-1">
                                                <h3 className="text-xl font-semibold text-gray-800">{schedule.candidateName}</h3>
                                                <p className="text-gray-600">{schedule.jobTitle} at {schedule.clientCompany}</p>
                                                <p className="text-sm text-gray-500 mt-1">
                                                    Created: {new Date(schedule.createdAt.seconds * 1000).toLocaleDateString()}
                                                </p>
                                                {schedule.bookedSlot && (
                                                    <div className="mt-2 inline-block bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium">
                                                        Interview Booked: {schedule.bookedSlot.date} at {minutesToTime(schedule.bookedSlot.time)}
                                                    </div>
                                                )}
                                            </div>
                                            <div className="flex flex-col sm:flex-row gap-3">
                                                <button
                                                    onClick={() => copyToClipboard(generateShareableLink(schedule.id))}
                                                    className="bg-blue-100 hover:bg-blue-200 text-blue-700 px-4 py-2 rounded-lg text-sm font-medium transition-colors"
                                                >
                                                    Copy Candidate Link
                                                </button>
                                                <button
                                                    onClick={() => copyToClipboard(generateShareableLink(schedule.id, true))}
                                                    className="bg-purple-100 hover:bg-purple-200 text-purple-700 px-4 py-2 rounded-lg text-sm font-medium transition-colors"
                                                >
                                                    Copy Client Link
                                                </button>
                                                <button
                                                    onClick={() => deleteSchedule(schedule.id)}
                                                    className="bg-red-100 hover:bg-red-200 text-red-700 px-4 py-2 rounded-lg text-sm font-medium transition-colors"
                                                >
                                                    Delete
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                ))
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        // Candidate Portal Component
        const CandidatePortal = ({ scheduleId }) => {
            const [schedule, setSchedule] = useState(null);
            const [loading, setLoading] = useState(true);
            const [selectedSlots, setSelectedSlots] = useState({});
            const [submitting, setSubmitting] = useState(false);
            const [submitted, setSubmitted] = useState(false);

            const workdays = getNextWorkdays();
            const timeSlots = generateTimeSlots();

            useEffect(() => {
                loadSchedule();
            }, [scheduleId]);

            const loadSchedule = async () => {
                try {
                    const docRef = db.collection('schedules').doc(scheduleId);
                    const doc = await docRef.get();
                    if (doc.exists) {
                        const scheduleData = doc.data();
if (doc.exists) {
  const scheduleData = doc.data();

  // --- Normalize any stored times to integer "minutes since midnight" ---
  if (scheduleData.candidateAvailability) {
    Object.entries(scheduleData.candidateAvailability).forEach(([dateKey, times]) => {
      scheduleData.candidateAvailability[dateKey] = times.map(t =>
        typeof t === 'number' ? t : timeToMinutes(t)
      );
    });
  }

  if (scheduleData.bookedSlot && typeof scheduleData.bookedSlot.time === 'string') {
    scheduleData.bookedSlot.time = timeToMinutes(scheduleData.bookedSlot.time);
  }

  // --- Canonicalize and write back if needed ---
  const updates = {};

  if (scheduleData.candidateAvailability) {
    const normalized = {};
    let changed = false;

    for (const [date, times] of Object.entries(scheduleData.candidateAvailability)) {
      normalized[date] = times.map(t => {
        const canon = canonicalizeTime(t);
        if (canon !== t) changed = true;
        return canon;
      });
    }

    if (changed) {
      updates.candidateAvailability = normalized;
      scheduleData.candidateAvailability = normalized;
    }
  }

  if (scheduleData.bookedSlot?.time) {
    const canon = canonicalizeTime(scheduleData.bookedSlot.time);
    if (canon !== scheduleData.bookedSlot.time) {
      scheduleData.bookedSlot.time = canon;
      updates.bookedSlot = scheduleData.bookedSlot;
    }
  }

  if (Object.keys(updates).length > 0) {
    await docRef.update(updates);
  }

  // --- Keep the existing state updates ---
  setSchedule(scheduleData);
  setSelectedSlots(scheduleData.candidateAvailability || {});
  setSubmitted(
    !!(
      scheduleData.candidateAvailability &&
      Object.values(scheduleData.candidateAvailability || {}).length > 0
    )
  );
}

                        setSchedule(scheduleData);
                        setSelectedSlots(scheduleData.candidateAvailability || {});
                        setSubmitted(Object.keys(scheduleData.candidateAvailability || {}).length > 0);
                    }
                } catch (error) {
                    console.error('Error loading schedule:', error);
                } finally {
                    setLoading(false);
                }
            };

            const toggleSlot = (date, time) => {
                if (schedule.bookedSlot) return; // Prevent changes if interview is booked
                
                const dateKey = date.toISOString().split('T')[0];
                const newSelectedSlots = { ...selectedSlots };
                
                if (!newSelectedSlots[dateKey]) {
                    newSelectedSlots[dateKey] = [];
                }
                
                const slotIndex = newSelectedSlots[dateKey].indexOf(time);
                if (slotIndex > -1) {
                    newSelectedSlots[dateKey].splice(slotIndex, 1);
                    if (newSelectedSlots[dateKey].length === 0) {
                        delete newSelectedSlots[dateKey];
                    }
                } else {
                    newSelectedSlots[dateKey].push(time);
                }
                
                setSelectedSlots(newSelectedSlots);
            };

            const submitAvailability = async () => {
                setSubmitting(true);
                try {
                    const normalized = {};
                    Object.entries(selectedSlots).forEach(([dateKey, times]) => {
                        normalized[dateKey] = times.map(t => typeof t === 'number' ? t : timeToMinutes(t));
                    });
                    await db.collection('schedules').doc(scheduleId).update({
                        candidateAvailability: normalized
                    });
                    setSubmitted(true);
                } catch (error) {
                    console.error('Error submitting availability:', error);
                } finally {
                    setSubmitting(false);
                }
            };

            if (loading) return <LoadingSpinner />;
            if (!schedule) return (
                <div className="max-w-2xl mx-auto p-6 text-center">
                    <div className="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">
                        Schedule not found
                    </div>
                </div>
            );

            return (
                <div className="max-w-4xl mx-auto p-6">
                    <div className="bg-white rounded-xl shadow-lg p-8">
                        <div className="text-center mb-8">
                            <h1 className="text-3xl font-bold text-gray-800 mb-2">Interview Availability</h1>
                            <h2 className="text-xl text-gray-600">{schedule.candidateName}</h2>
                            <p className="text-lg text-gray-500">{schedule.jobTitle} at {schedule.clientCompany}</p>
                        </div>

                        {schedule.bookedSlot ? (
                            <div className="bg-green-50 border border-green-200 rounded-lg p-6 text-center">
                                <div className="text-green-600 text-4xl mb-4">✅</div>
                                <h3 className="text-xl font-semibold text-green-800 mb-2">Interview Confirmed!</h3>
                                <p className="text-green-700">
                                    Your interview is scheduled for <strong>{schedule.bookedSlot.date}</strong> at <strong>{minutesToTime(schedule.bookedSlot.time)}</strong>
                                </p>
                            </div>
                        ) : (
                            <>
                                <div className="mb-6">
                                    <p className="text-gray-600 text-center">
                                        Please select your available time slots. You can choose multiple slots across different days.
                                    </p>
                                </div>

                                <div className="space-y-6">
                                    {workdays.map(date => {
                                        const dateKey = date.toISOString().split('T')[0];
                                        return (
                                            <div key={dateKey} className="bg-gray-50 rounded-lg p-6">
                                                <h3 className="text-lg font-semibold text-gray-800 mb-4">
                                                    {formatDate(date)}
                                                </h3>
                                                <div className="grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-6 gap-3">
                                                    {timeSlots.map(time => {
                                                        const isSelected = selectedSlots[dateKey]?.includes(time);
                                                        return (
                                                            <button
                                                                key={time}
                                                                onClick={() => toggleSlot(date, time)}
                                                                className={`slot-button px-4 py-2 rounded-lg text-sm font-medium ${
                                                                    isSelected
                                                                        ? 'bg-blue-600 text-white'
                                                                        : 'bg-white border border-gray-300 text-gray-700 hover:bg-blue-50'
                                                                }`}
                                                            >
                                                                {minutesToTime(time)}
                                                            </button>
                                                        );
                                                    })}
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>

                                <div className="mt-8 text-center">
                                    {submitted ? (
                                        <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
                                            <p className="text-blue-800 font-medium">
                                                ✅ Availability submitted successfully! The client will select a time slot from your available times.
                                            </p>
                                        </div>
                                    ) : (
                                        <button
                                            onClick={submitAvailability}
                                            disabled={submitting || Object.keys(selectedSlots).length === 0}
                                            className="bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white px-8 py-3 rounded-lg font-medium transition-colors"
                                        >
                                            {submitting ? 'Submitting...' : 'Submit Availability'}
                                        </button>
                                    )}
                                </div>
                            </>
                        )}
                    </div>
                </div>
            );
        };

        // Client Booking Component
        const ClientBooking = ({ scheduleId }) => {
            const [schedule, setSchedule] = useState(null);
            const [loading, setLoading] = useState(true);
            const [selectedSlot, setSelectedSlot] = useState(null);
            const [booking, setBooking] = useState(false);

            useEffect(() => {
                loadSchedule();
            }, [scheduleId]);

            const loadSchedule = async () => {
                try {
                    const docRef = db.collection('schedules').doc(scheduleId);
                    const doc = await docRef.get();
                    if (doc.exists) {
                        const scheduleData = doc.data();
if (doc.exists) {
  const scheduleData = doc.data();

  // --- Normalize any stored times to integer "minutes since midnight" ---
  if (scheduleData.candidateAvailability) {
    Object.entries(scheduleData.candidateAvailability).forEach(([dateKey, times]) => {
      scheduleData.candidateAvailability[dateKey] = (times || []).map(t =>
        typeof t === 'number' ? t : timeToMinutes(t)
      );
    });
  }

  if (scheduleData.bookedSlot && typeof scheduleData.bookedSlot.time === 'string') {
    scheduleData.bookedSlot.time = timeToMinutes(scheduleData.bookedSlot.time);
  }

  // --- Canonicalize and write back if needed ---
  const updates = {};

  if (scheduleData.candidateAvailability) {
    const normalized = {};
    let changed = false;

    for (const [date, times] of Object.entries(scheduleData.candidateAvailability)) {
      normalized[date] = (times || []).map(t => {
        const canon = canonicalizeTime(t);
        if (canon !== t) changed = true;
        return canon;
      });
    }

    if (changed) {
      updates.candidateAvailability = normalized;
      scheduleData.candidateAvailability = normalized;
    }
  }

  if (scheduleData.bookedSlot?.time != null) {
    const canon = canonicalizeTime(scheduleData.bookedSlot.time);
    if (canon !== scheduleData.bookedSlot.time) {
      scheduleData.bookedSlot.time = canon;
      updates.bookedSlot = scheduleData.bookedSlot;
    }
  }

  if (Object.keys(updates).length > 0) {
    await docRef.update(updates);
  }

  // --- Update component state (keep from main) ---
  setSchedule(scheduleData);
  setSelectedSlots(scheduleData.candidateAvailability || {});
  setSubmitted(
    !!(
      scheduleData.candidateAvailability &&
      Object.values(scheduleData.candidateAvailability).some(arr => (arr || []).length > 0)
    )
  );
}

                        setSchedule(scheduleData);
                    }
                } catch (error) {
                    console.error('Error loading schedule:', error);
                } finally {
                    setLoading(false);
                }
            };

            const bookSlot = async (date, time) => {
                setBooking(true);
                try {
                    const bookedSlot = {
                        date: formatDate(new Date(date)),
                        time: time,
                        bookedAt: new Date()
                    };
                    
                    await db.collection('schedules').doc(scheduleId).update({
                        bookedSlot: bookedSlot,
                        status: 'booked'
                    });
                    
                    setSchedule({...schedule, bookedSlot});
                } catch (error) {
                    console.error('Error booking slot:', error);
                } finally {
                    setBooking(false);
                }
            };

            if (loading) return <LoadingSpinner />;
            if (!schedule) return (
                <div className="max-w-2xl mx-auto p-6 text-center">
                    <div className="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">
                        Schedule not found
                    </div>
                </div>
            );

            const availableSlots = schedule.candidateAvailability || {};

            return (
                <div className="max-w-4xl mx-auto p-6">
                    <div className="bg-white rounded-xl shadow-lg p-8">
                        <div className="text-center mb-8">
                            <h1 className="text-3xl font-bold text-gray-800 mb-2">Book Interview</h1>
                            <h2 className="text-xl text-gray-600">{schedule.candidateName}</h2>
                            <p className="text-lg text-gray-500">{schedule.jobTitle}</p>
                        </div>

                        {schedule.bookedSlot ? (
                            <div className="bg-green-50 border border-green-200 rounded-lg p-6 text-center">
                                <div className="text-green-600 text-4xl mb-4">✅</div>
                                <h3 className="text-xl font-semibold text-green-800 mb-2">Interview Booked!</h3>
                                <p className="text-green-700">
                                    Interview scheduled for <strong>{schedule.bookedSlot.date}</strong> at <strong>{minutesToTime(schedule.bookedSlot.time)}</strong>
                                </p>
                            </div>
                        ) : Object.keys(availableSlots).length === 0 ? (
                            <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-6 text-center">
                                <div className="text-yellow-600 text-4xl mb-4">⏳</div>
                                <h3 className="text-xl font-semibold text-yellow-800 mb-2">Waiting for Candidate</h3>
                                <p className="text-yellow-700">
                                    The candidate hasn't submitted their availability yet. Please check back later.
                                </p>
                            </div>
                        ) : (
                            <>
                                <div className="mb-6">
                                    <p className="text-gray-600 text-center">
                                        Select one time slot from the candidate's available times to book the interview.
                                    </p>
                                </div>

                                <div className="space-y-6">
                                    {Object.entries(availableSlots).map(([dateKey, times]) => {
                                        const date = new Date(dateKey);
                                        return (
                                            <div key={dateKey} className="bg-gray-50 rounded-lg p-6">
                                                <h3 className="text-lg font-semibold text-gray-800 mb-4">
                                                    {formatDate(date)}
                                                </h3>
                                                <div className="grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-6 gap-3">
                                                    {times.map(time => (
                                                        <button
                                                            key={time}
                                                            onClick={() => bookSlot(dateKey, time)}
                                                            disabled={booking}
                                                            className="slot-button bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors"
                                                        >
                                                            {booking ? 'Booking...' : minutesToTime(time)}
                                                        </button>
                                                    ))}
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            </>
                        )}
                    </div>
                </div>
            );
        };

        // Main App Component
        const App = () => {
            const [currentView, setCurrentView] = useState('dashboard');
            const [scheduleId, setScheduleId] = useState(null);
            const [isClient, setIsClient] = useState(false);

            useEffect(() => {
                // Parse URL parameters
                const urlParams = new URLSearchParams(window.location.search);
                const id = urlParams.get('id');
                const client = urlParams.get('client');

                if (id) {
                    setScheduleId(id);
                    setIsClient(client === 'true');
                    setCurrentView(client === 'true' ? 'client' : 'candidate');
                }
            }, []);

            const renderView = () => {
                switch (currentView) {
                    case 'candidate':
                        return <CandidatePortal scheduleId={scheduleId} />;
                    case 'client':
                        return <ClientBooking scheduleId={scheduleId} />;
                    default:
                        return <RecruiterDashboard setCurrentView={setCurrentView} setScheduleId={setScheduleId} setIsClient={setIsClient} />;
                }
            };

            return (
                <div className="min-h-screen">
                    {currentView === 'dashboard' && (
                        <nav className="bg-white shadow-sm border-b">
                            <div className="max-w-6xl mx-auto px-6 py-4">
                                <h1 className="text-2xl font-bold text-gray-800">Interview Scheduler</h1>
                            </div>
                        </nav>
                    )}
                    
                    <main className="py-8">
                        {renderView()}
                    </main>

                    {currentView !== 'dashboard' && (
                        <div className="fixed bottom-6 left-6">
                            <button
                                onClick={() => {
                                    window.history.pushState({}, '', window.location.pathname);
                                    setCurrentView('dashboard');
                                    setScheduleId(null);
                                    setIsClient(false);
                                }}
                                className="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors"
                            >
                                ← Back to Dashboard
                            </button>
                        </div>
                    )}
                </div>
            );
        };

        // Render the app
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'975df0170035f0a6',t:'MTc1NjMyMjU0OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
